#!/usr/bin/env bash
if [ -f "/vagrant/[project.json" ]; then
    database="$(jq -r '.startup.database' < /vagrant/project.json)"
    webserver="$(jq -r '.startup.webserver' < /vagrant/project.json)"
    processvm="$(jq -r '.startup.processvm' < /vagrant/project.json)"
    kvstore="$(jq -r '.startup.kvstore' < /vagrant/project.json)"

    if [ -z "$database" ]; then
        database=mysql
    fi

    if [ -z "$webserver" ];  then
        webserver=nginx
    fi

    if [ -z "$processvm" ]; then
        processvm=php7.0
    fi

    if [ -z "$object_cache" ]; then
        object_cache=redis
    fi
else
    database=mysql
    webserver=nginx
    processvm=php7.0
    kvstore=redis
fi

docker start $database 2>&1 > /dev/null
docker start $webserver 2>&1 > /dev/null
docker start $kvstore 2>&1 > /dev/null

if [ "php7.1" == $processvm ]; then
    if [ ! -f "/var/run/php/php7.1-fpm.pid" ]; then
        sudo service php7.1-fpm start 2>&1 > /dev/null
    fi
else
    case $processvm in
        php5.6)
            processvm=php5_fpm
            ;;
        php7.0)
            processvm=php7_fpm
            ;;
    esac

    docker start $processvm 2>&1 > /dev/null
fi
